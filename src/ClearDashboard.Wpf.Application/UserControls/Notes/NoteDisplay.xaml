<UserControl
    x:Class="ClearDashboard.Wpf.Application.UserControls.Notes.NoteDisplay"
    x:Name="NotesDisplayControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="clr-namespace:ClearDashboard.Wpf.Application.Helpers;assembly=ClearDashboard.Wpf.Application.Abstractions"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:resx="clr-namespace:ClearDashboard.Wpf.Application.Strings"
    xmlns:userControls="clr-namespace:ClearDashboard.Wpf.Application.UserControls"
    xmlns:notes="clr-namespace:ClearDashboard.Wpf.Application.UserControls.Notes"
    d:DesignHeight="450"
    d:DesignWidth="800"
    helpers:Translation.ResourceManager="{x:Static resx:Resources.ResourceManager}"
    FontSize="16"
    mc:Ignorable="d">
    <Border
        Margin="0,0,0,0"
        Padding="{Binding ElementName=NotesDisplayControl, Path=NoteBorderPadding}"
        BorderBrush="{Binding ElementName=NotesDisplayControl, Path=NoteBorderBrush}"
        BorderThickness="{Binding ElementName=NotesDisplayControl, Path=NoteBorderThickness}"
        CornerRadius="{Binding ElementName=NotesDisplayControl, Path=NoteBorderCornerRadius}"
        MouseEnter="OnMouseEnter"
        MouseLeave="OnMouseLeave"
        MouseLeftButtonUp="NoteDisplayBorder_OnMouseLeftButtonUp">
        <Border.Style>
            <Style TargetType="{x:Type Border}">
                <Setter Property="Background" Value="Transparent" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter Property="Background" Value="{Binding ElementName=NotesDisplayControl, Path=NoteHoverBrush}" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Border.Style>

        <StackPanel Orientation="Vertical">
            <!-- Note text and delete button -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Margin="{Binding ElementName=NotesDisplayControl, Path=NoteTextMargin}"
                           Padding="{Binding ElementName=NotesDisplayControl, Path=NoteTextPadding}"
                           FontFamily="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontFamily}"
                           FontSize="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontSize}"
                           FontStyle="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontStyle}"
                           FontWeight="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontWeight}"
                           MouseDown="OnNoteLabelClick"
                           Text="{Binding ElementName=NotesDisplayControl, Path=Note.Text}"
                           TextWrapping="Wrap"
                           Visibility="{Binding ElementName=NotesDisplayControl, Path=NoteLabelVisibility}" />
                <TextBox Grid.Column="0"
                         x:Name="NoteTextBox"
                         Margin="{Binding ElementName=NotesDisplayControl, Path=NoteTextMargin}"
                         Padding="{Binding ElementName=NotesDisplayControl, Path=NoteTextPadding}"
                         FontFamily="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontFamily}"
                         FontSize="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontSize}"
                         FontStyle="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontStyle}"
                         FontWeight="{Binding ElementName=NotesDisplayControl, Path=NoteTextFontWeight}"
                         Text="{Binding ElementName=NotesDisplayControl, Path=Note.Text}"
                         TextChanged="OnNoteTextBoxChanged"
                         TextWrapping="Wrap"
                         Visibility="{Binding ElementName=NotesDisplayControl, Path=NoteTextBoxVisibility}" />
                <TextBlock Grid.Column="0"
                           Grid.Row="0"
                           Margin="4,0,0,0"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           Foreground="DarkGray"
                           IsHitTestVisible="False"
                           Text="{Binding ElementName=NotesDisplayControl, Path=Watermark}">
                    <TextBlock.Style>
                        <Style TargetType="{x:Type TextBlock}">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Text, ElementName=NoteTextBox}" Value="">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <Button Grid.Column="1"
                        x:Name="DeleteNoteButton"
                        Margin="9,-5,0,0"
                        Padding="0,0,0,0"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="ConfirmNoteDeletion"
                        FontSize="12"
                        FontWeight="SemiBold"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=TimestampRowVisibility}">
                    <Image Height="18" Source="/Resources/close24.png" />
                </Button>
                <Popup Grid.Column="1"
                       x:Name="ConfirmDeletePopup"
                       Placement="Left"
                       PlacementTarget="{Binding ElementName=DeleteNoteButton}"
                       StaysOpen="False"
                       VerticalOffset="30">
                    <Border BorderThickness="2">
                        <StackPanel Background="{StaticResource SecondaryHueMidBrush}" Orientation="Vertical">
                            <TextBlock
                                Padding="10"
                                HorizontalAlignment="Center"
                                FontWeight="Bold"
                                Text="{helpers:Localization Notes_DeleteConfirmation}" />
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <Button
                                    Margin="5"
                                    Click="DeleteNoteConfirmed"
                                    Content="{helpers:Localization Yes}"
                                    Style="{StaticResource TransparentStyle}" />
                                <Button
                                    Margin="5"
                                    Click="DeleteNoteCancelled"
                                    Content="{helpers:Localization No}"
                                    Style="{StaticResource TransparentStyle}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Popup>
            </Grid>

            <!-- User and timestamp -->
            <Grid
                Margin="0,0"
                VerticalAlignment="Top"
                Visibility="{Binding ElementName=NotesDisplayControl, Path=TimestampRowVisibility}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>
                <Label
                    Grid.Column="0"
                    Margin="{Binding ElementName=NotesDisplayControl, Path=UserMargin}"
                    VerticalContentAlignment="Top"
                    Content="{Binding ElementName=NotesDisplayControl, Path=Note.ModifiedBy}"
                    FontFamily="{Binding ElementName=NotesDisplayControl, Path=UserFontFamily}"
                    FontSize="{Binding ElementName=NotesDisplayControl, Path=UserFontSize}"
                    FontStyle="{Binding ElementName=NotesDisplayControl, Path=UserFontStyle}"
                    FontWeight="{Binding ElementName=NotesDisplayControl, Path=UserFontWeight}" />
                <Label
                    Grid.Column="1"
                    Margin="{Binding ElementName=NotesDisplayControl, Path=TimestampMargin}"
                    HorizontalAlignment="Right"
                    HorizontalContentAlignment="Right"
                    VerticalContentAlignment="Top"
                    Content="{Binding ElementName=NotesDisplayControl, Path=Note.ModifiedLocalTime}"
                    FontFamily="{Binding ElementName=NotesDisplayControl, Path=TimestampFontFamily}"
                    FontSize="{Binding ElementName=NotesDisplayControl, Path=TimestampFontSize}"
                    FontStyle="{Binding ElementName=NotesDisplayControl, Path=UserFontStyle}"
                    FontWeight="{Binding ElementName=NotesDisplayControl, Path=UserFontWeight}" />
            </Grid>

            <!-- Apply and Cancel buttons -->
            <StackPanel
                HorizontalAlignment="Center"
                Orientation="Horizontal"
                Visibility="{Binding ElementName=NotesDisplayControl, Path=NoteSaveCancelButtonVisibility}">
                <Button
                    Height="40"
                    Margin="5"
                    Click="ApplyNote"
                    Content="{Binding ElementName=NotesDisplayControl, Path=ApplyLabel}"
                    FontSize="11"
                    Foreground="{DynamicResource MaterialDesignBody}"
                    Style="{StaticResource TransparentStyle}" />
                <Button
                    Height="40"
                    Margin="5"
                    Click="Cancel"
                    Content="{helpers:Localization Cancel}"
                    FontSize="11"
                    Foreground="{DynamicResource MaterialDesignBody}"
                    Style="{StaticResource TransparentStyle}" />
            </StackPanel>

            <!-- Note properties: Labels, Associations, Replies, etc. -->
            <StackPanel Margin="0,10,0,0"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=NotePropertiesVisibility}">

                <!-- Labels -->
                <userControls:TogglePanel IsOpen="True">
                    <userControls:TogglePanel.Header>
                        <Label Content="{helpers:Localization Notes_NoteLabels}"
                               FontSize="13"
                               FontWeight="SemiBold" />
                    </userControls:TogglePanel.Header>
                    <notes:LabelsEditor CurrentUserId="{Binding ElementName=NotesDisplayControl, Path=CurrentUserId}"
                                        CurrentLabelGroup="{Binding ElementName=NotesDisplayControl, Path=DefaultLabelGroup, Mode=OneWay}"
                                        LabelAdded="OnLabelAdded"
                                        LabelBackground="{Binding ElementName=NotesDisplayControl, Path=LabelBackground}"
                                        LabelCornerRadius="{Binding ElementName=NotesDisplayControl, Path=LabelCornerRadius}"
                                        LabelFontSize="{Binding ElementName=NotesDisplayControl, Path=LabelFontSize}"
                                        LabelGroupAdded="OnLabelGroupAdded"
                                        LabelGroupSelected="OnLabelGroupSelected"
                                        LabelGroups="{Binding ElementName=NotesDisplayControl, Path=LabelGroups}"
                                        LabelMargin="{Binding ElementName=NotesDisplayControl, Path=LabelMargin}"
                                        LabelPadding="{Binding ElementName=NotesDisplayControl, Path=LabelPadding}"
                                        LabelRemoved="OnLabelRemoved"
                                        LabelSelected="OnLabelSelected"
                                        Labels="{Binding ElementName=NotesDisplayControl, Path=Note.Labels}"
                                        Margin="0,0,0,10"
                                        Note="{Binding ElementName=NotesDisplayControl, Path=Note}" />
                </userControls:TogglePanel>

                <!-- Associations -->
                <userControls:TogglePanel IsOpen="False">
                    <userControls:TogglePanel.Header>
                        <Label Content="{helpers:Localization Notes_NoteAssociationDescriptions}"
                               FontSize="13"
                               FontWeight="SemiBold" />
                    </userControls:TogglePanel.Header>
                    <notes:NoteAssociationsDisplay 
                                               FontFamily="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontFamily}"
                                               FontSize="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontSize}"
                                               FontStyle="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontStyle}"
                                               FontWeight="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontWeight}"
                                               InnerMargin="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationMargin}"
                                               InnerPadding="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationPadding}"
                                               Margin="10,0,0,0"
                                               Note="{Binding ElementName=NotesDisplayControl, Path=Note}"
                                               NoteAssociationClicked="OnNoteAssociationClicked"
                                               NoteAssociationDoubleClicked="OnNoteAssociationDoubleClicked"
                                               NoteAssociationLeftButtonDown="OnNoteAssociationLeftButtonDown"
                                               NoteAssociationLeftButtonUp="OnNoteAssociationLeftButtonUp"
                                               NoteAssociationMouseEnter="OnNoteAssociationMouseEnter"
                                               NoteAssociationMouseLeave="OnNoteAssociationMouseLeave"
                                               NoteAssociationRightButtonDown="OnNoteAssociationRightButtonDown"
                                               NoteAssociationRightButtonUp="OnNoteAssociationRightButtonUp"/>
                </userControls:TogglePanel>

                <!-- Associations -->
                <userControls:TogglePanel IsOpen="False">
                    <userControls:TogglePanel.Header>
                        <Label Content="{helpers:Localization Notes_NoteReplies}"
                               FontSize="13"
                               FontWeight="SemiBold" />
                    </userControls:TogglePanel.Header>
                </userControls:TogglePanel>
            </StackPanel>
            <!-- Labels -->
            <!--<Grid Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <Label
                    Grid.Row="0"
                    Grid.Column="0"
                    Content="{helpers:Localization Notes_NoteLabels}"
                    FontSize="13"
                    FontWeight="SemiBold"
                    Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}" />
                <StackPanel
                    Grid.Row="0"
                    Grid.Column="1"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Orientation="Vertical">
                    <notes:LabelsDisplay
                        LabelFontSize="{Binding ElementName=NotesDisplayControl, Path=LabelFontSize}"
                        LabelBackground="{Binding ElementName=NotesDisplayControl, Path=LabelBackground}"
                        LabelCornerRadius="{Binding ElementName=NotesDisplayControl, Path=LabelCornerRadius}"
                        LabelMargin="{Binding ElementName=NotesDisplayControl, Path=LabelMargin}"
                        LabelPadding="{Binding ElementName=NotesDisplayControl, Path=LabelPadding}"
                        LabelRemoved="OnLabelRemoved"
                        Labels="{Binding ElementName=NotesDisplayControl, Path=Note.Labels}"
                        Note="{Binding ElementName=NotesDisplayControl, Path=Note}"
                        Orientation="Vertical" />
                    <notes:LabelSelector
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        VerticalContentAlignment="Center"
                        LabelAdded="OnLabelAdded"
                        LabelSelected="OnLabelSelected"
                        LabelSuggestions="{Binding ElementName=NotesDisplayControl, Path=LabelSuggestions}"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}" />
                </StackPanel>
            </Grid>-->

            <!--<Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
 
                <Label Grid.Row="0" Grid.Column="0">Toggle</Label>
                <Button Grid.Column="1" Grid.Row="0"
                        Width="Auto"
                        Height="Auto"
                        Margin="0,0,0,0"
                        Padding="0"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Left"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="OnToggleClick"
                        FontSize="13"
                        FontWeight="SemiBold"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}">
                    <materialDesign:PackIcon
                        Margin="0,2,0,0"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=AssociationsButtonVisibility}" >
                        <materialDesign:PackIcon.Style>
                            <Style TargetType="{x:Type materialDesign:PackIcon}">
                                <Setter Property="Kind" Value="ArrowDownThin" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsToggled, ElementName=NotesDisplayControl}" Value="true">
                                        <Setter Property="Kind" Value="ArrowUpThin" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsToggled, ElementName=NotesDisplayControl}" Value="false">
                                        <Setter Property="Kind" Value="ArrowDownThin" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </materialDesign:PackIcon.Style>
                    </materialDesign:PackIcon>
                </Button>
                <Label Grid.Row="1" Grid.Column="0">
                    <Label.Style>
                        <Style TargetType="{x:Type Label}">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsToggled, ElementName=NotesDisplayControl}" Value="true">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Label.Style>

                    Content
                </Label>
            </Grid>-->

            <!-- Associations -->
            <!--<Grid Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition/>
                    <RowDefinition/>
                </Grid.RowDefinitions>
                <Button Grid.Column="0" Grid.Row="0"
                        Width="Auto"
                        Height="Auto"
                        Margin="0,0,0,0"
                        Padding="0"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Left"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="OnAssociationsButtonClick"
                        FontSize="13"
                        FontWeight="SemiBold"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}">
                    <Label Content="{helpers:Localization Notes_NoteAssociationDescriptions}" />
                </Button>
                <Button Grid.Column="1" Grid.Row="0"
                        Width="Auto"
                        Height="Auto"
                        Margin="0,0,0,0"
                        Padding="0"
                        HorizontalAlignment="Left"
                        HorizontalContentAlignment="Left"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="OnAssociationsButtonClick"
                        FontSize="13"
                        FontWeight="SemiBold"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=LabelSelectorVisibility}">
                    <materialDesign:PackIcon
                        Margin="0,2,0,0"
                        Kind="ArrowDownThin"
                        Visibility="{Binding ElementName=NotesDisplayControl, Path=AssociationsButtonVisibility}" />
                </Button>
                <notes:NoteAssociationsDisplay Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2"
                                               Margin="10,0,0,0"
                                               FontFamily="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontFamily}"
                                               FontSize="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontSize}"
                                               FontStyle="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontStyle}"
                                               FontWeight="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationFontWeight}"
                                               InnerMargin="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationMargin}"
                                               InnerPadding="{Binding ElementName=NotesDisplayControl, Path=NoteAssociationPadding}"
                                               Note="{Binding ElementName=NotesDisplayControl, Path=Note}"
                                               NoteAssociationClicked="OnNoteAssociationClicked"
                                               NoteAssociationDoubleClicked="OnNoteAssociationDoubleClicked"
                                               NoteAssociationLeftButtonDown="OnNoteAssociationLeftButtonDown"
                                               NoteAssociationLeftButtonUp="OnNoteAssociationLeftButtonUp"
                                               NoteAssociationMouseEnter="OnNoteAssociationMouseEnter"
                                               NoteAssociationMouseLeave="OnNoteAssociationMouseLeave"
                                               NoteAssociationRightButtonDown="OnNoteAssociationRightButtonDown"
                                               NoteAssociationRightButtonUp="OnNoteAssociationRightButtonUp"
                                               Visibility="{Binding ElementName=NotesDisplayControl, Path=AssociationsVisibility}" />
            </Grid>-->
            
            <!-- Paratext send -->
            <StackPanel
                    Grid.Row="3"
                    Grid.Column="1"
                    Orientation="Vertical"
                    Visibility="{Binding ElementName=NotesDisplayControl, Path=ParatextSendVisibility}">
                    <Button
                        Name="SendToParatextButton"
                        Margin="10,-5,10,0"
                        Padding="0,0,0,0"
                        HorizontalAlignment="Right"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="ConfirmParatextSend"
                        FontSize="12"
                        FontWeight="SemiBold"
                        ToolTip="{helpers:Localization Notes_SendToParatext}">
                        <Image Height="18" Source="/Resources/Paratext_Send32.png" />
                    </Button>
                    <Popup
                        Name="ConfirmParatextSendPopup"
                        HorizontalOffset="100"
                        Placement="Left"
                        PlacementTarget="{Binding ElementName=SendToParatextButton}"
                        StaysOpen="False"
                        VerticalOffset="30">
                        <Border BorderThickness="2">
                            <StackPanel Background="LightGreen" Orientation="Vertical">
                                <TextBlock
                                    Padding="10"
                                    HorizontalAlignment="Center"
                                    FontWeight="Bold"
                                    Text="{helpers:Localization Notes_SendConfirmation}" />
                                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                    <Button
                                        Margin="5"
                                        Click="ParatextSendConfirmed"
                                        Content="{helpers:Localization Yes}" />
                                    <Button
                                        Margin="5"
                                        Click="ParatextSendCancelled"
                                        Content="{helpers:Localization No}" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Popup>
                </StackPanel>
        </StackPanel>
    </Border>
</UserControl>